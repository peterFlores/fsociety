!function(e,t){"object"==typeof exports&&"undefined"!=typeof module?t(exports,require("@angular/core"),require("rxjs"),require("@angular/common")):"function"==typeof define&&define.amd?define("angularx-social-login",["exports","@angular/core","rxjs","@angular/common"],t):t((e=e||self)["angularx-social-login"]={},e.ng.core,e.rxjs,e.ng.common)}(this,(function(e,t,n,i){"use strict";var o=function(){function e(e){var t=this;this.providers=new Map,this.autoLogin=!1,this._user=null,this._authState=new n.ReplaySubject(1),this.initialized=!1,this._initState=new n.AsyncSubject,e instanceof Promise?e.then((function(e){t.initialize(e)})):this.initialize(e)}return Object.defineProperty(e.prototype,"authState",{get:function(){return this._authState.asObservable()},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"initState",{get:function(){return this._initState.asObservable()},enumerable:!1,configurable:!0}),e.prototype.initialize=function(e){var t=this;this.autoLogin=void 0!==e.autoLogin&&e.autoLogin,e.providers.forEach((function(e){t.providers.set(e.id,e.provider)})),Promise.all(Array.from(this.providers.values()).map((function(e){return e.initialize()}))).then((function(){if(t.initialized=!0,t._initState.next(t.initialized),t._initState.complete(),t.autoLogin){var e=[],n=!1;t.providers.forEach((function(i,o){var r=i.getLoginStatus();e.push(r),r.then((function(e){e.provider=o,t._user=e,t._authState.next(e),n=!0})).catch(console.debug)})),Promise.all(e).catch((function(){n||(t._user=null,t._authState.next(null))}))}})).catch(console.error)},e.prototype.signIn=function(t,n){var i=this;return new Promise((function(o,r){if(i.initialized){var a=i.providers.get(t);a?a.signIn(n).then((function(e){e.provider=t,o(e),i._user=e,i._authState.next(e)})).catch((function(e){r(e)})):r(e.ERR_LOGIN_PROVIDER_NOT_FOUND)}else r(e.ERR_NOT_INITIALIZED)}))},e.prototype.signOut=function(t){var n=this;return void 0===t&&(t=!1),new Promise((function(i,o){if(n.initialized)if(n._user){var r=n._user.provider,a=n.providers.get(r);a?a.signOut(t).then((function(){i(),n._user=null,n._authState.next(null)})).catch((function(e){o(e)})):o(e.ERR_LOGIN_PROVIDER_NOT_FOUND)}else o(e.ERR_NOT_LOGGED_IN);else o(e.ERR_NOT_INITIALIZED)}))},e}();o.ERR_LOGIN_PROVIDER_NOT_FOUND="Login provider not found",o.ERR_NOT_LOGGED_IN="Not logged in",o.ERR_NOT_INITIALIZED="Login providers not ready yet. Are there errors on your console?",o.decorators=[{type:t.Injectable}],o.ctorParameters=function(){return[{type:void 0,decorators:[{type:t.Inject,args:["SocialAuthServiceConfig"]}]}]};var r=function(){function e(e){if(e)throw new Error("SocialLoginModule is already loaded. Import it in the AppModule only")}return e.initialize=function(t){return{ngModule:e,providers:[o,{provide:"SocialAuthServiceConfig",useValue:t}]}},e}();r.decorators=[{type:t.NgModule,args:[{imports:[i.CommonModule],providers:[o]}]}],r.ctorParameters=function(){return[{type:r,decorators:[{type:t.Optional},{type:t.SkipSelf}]}]};var a=function(){},s=function(){function e(){}return e.prototype.loadScript=function(e,t,n,i){if(void 0===i&&(i=null),"undefined"!=typeof document&&!document.getElementById(e)){var o=document.createElement("script");o.async=!0,o.src=t,o.onload=n,i||(i=document.head),i.appendChild(o)}},e}(),u=function(e,t){return(u=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var n in t)t.hasOwnProperty(n)&&(e[n]=t[n])})(e,t)};function c(e,t){function n(){this.constructor=e}u(e,t),e.prototype=null===t?Object.create(t):(n.prototype=t.prototype,new n)}Object.create;Object.create;var l=function(e){function t(n){var i=e.call(this)||this;return i.dummy=n||t.DEFAULT_USER,i.loggedIn=!1,i}return c(t,e),t.prototype.getLoginStatus=function(){var e=this;return new Promise((function(t,n){e.loggedIn?t(e.dummy):n("No user is currently logged in.")}))},t.prototype.initialize=function(){return new Promise((function(e,t){e()}))},t.prototype.signIn=function(){var e=this;return new Promise((function(t,n){e.loggedIn=!0,t(e.dummy)}))},t.prototype.signOut=function(e){var t=this;return new Promise((function(e,n){t.loggedIn=!1,e()}))},t}(s);l.PROVIDER_ID="DUMMY",l.DEFAULT_USER={id:"1234567890",name:"Mickey Mouse",email:"mickey@mouse.com",firstName:"Mickey",lastName:"Mouse",authToken:"dummyAuthToken",photoUrl:"https://en.wikipedia.org/wiki/File:Mickey_Mouse.png",provider:"DUMMY",idToken:"dummyIdToken",authorizationCode:"dummyAuthCode",response:{}};var p=function(e){function t(t,n){void 0===n&&(n={scope:"email"});var i=e.call(this)||this;return i.clientId=t,i.initOptions=n,i}return c(t,e),t.prototype.initialize=function(){var e=this;return new Promise((function(n,i){e.loadScript(t.PROVIDER_ID,"https://apis.google.com/js/platform.js",(function(){gapi.load("auth2",(function(){e.auth2=gapi.auth2.init(Object.assign(Object.assign({},e.initOptions),{client_id:e.clientId})),e.auth2.then((function(){n()})).catch((function(e){i(e)}))}))}))}))},t.prototype.getLoginStatus=function(){var e=this;return new Promise((function(n,i){if(e.auth2.isSignedIn.get()){var o=new a,r=e.auth2.currentUser.get().getBasicProfile(),s=e.auth2.currentUser.get().getAuthResponse(!0).access_token,u=e.auth2.currentUser.get().getAuthResponse(!0).id_token;o.id=r.getId(),o.name=r.getName(),o.email=r.getEmail(),o.photoUrl=r.getImageUrl(),o.firstName=r.getGivenName(),o.lastName=r.getFamilyName(),o.authToken=s,o.idToken=u,o.response=r,n(o)}else i("No user is currently logged in with "+t.PROVIDER_ID)}))},t.prototype.signIn=function(e){var t=this,n=Object.assign(Object.assign({},this.initOptions),e);return new Promise((function(i,o){(n&&n.offline_access?t.auth2.grantOfflineAccess(e):t.auth2.signIn(e)).then((function(e){var n=new a;if(e&&e.code)n.authorizationCode=e.code;else{var o=t.auth2.currentUser.get().getBasicProfile(),r=t.auth2.currentUser.get().getAuthResponse(!0).access_token,s=t.auth2.currentUser.get().getAuthResponse(!0).id_token;n.id=o.getId(),n.name=o.getName(),n.email=o.getEmail(),n.photoUrl=o.getImageUrl(),n.firstName=o.getGivenName(),n.lastName=o.getFamilyName(),n.authToken=r,n.idToken=s,n.response=o}i(n)}),(function(e){o(e)})).catch((function(e){o(e)}))}))},t.prototype.signOut=function(e){var t=this;return new Promise((function(n,i){(e?t.auth2.disconnect():t.auth2.signOut()).then((function(e){e?i(e):n()})).catch((function(e){i(e)}))}))},t}(s);p.PROVIDER_ID="GOOGLE";var f=function(e){function t(t,n){void 0===n&&(n={scope:"email,public_profile",locale:"en_US",fields:"name,email,picture,first_name,last_name",version:"v4.0"});var i=e.call(this)||this;return i.clientId=t,i.initOptions=n,i}return c(t,e),t.prototype.initialize=function(){var e=this;return new Promise((function(n,i){e.loadScript(t.PROVIDER_ID,"//connect.facebook.net/"+e.initOptions.locale+"/sdk.js",(function(){FB.init({appId:e.clientId,autoLogAppEvents:!0,cookie:!0,xfbml:!0,version:e.initOptions.version}),n()}))}))},t.prototype.getLoginStatus=function(){var e=this;return new Promise((function(n,i){FB.getLoginStatus((function(o){if("connected"===o.status){var r=o.authResponse;FB.api("/me?fields="+e.initOptions.fields,(function(e){var t=new a;t.id=e.id,t.name=e.name,t.email=e.email,t.photoUrl="https://graph.facebook.com/"+e.id+"/picture?type=normal",t.firstName=e.first_name,t.lastName=e.last_name,t.authToken=r.accessToken,t.response=e,n(t)}))}else i("No user is currently logged in with "+t.PROVIDER_ID)}))}))},t.prototype.signIn=function(e){var t=Object.assign(Object.assign({},this.initOptions),e);return new Promise((function(e,n){FB.login((function(i){if(i.authResponse){var o=i.authResponse;FB.api("/me?fields="+t.fields,(function(t){var n=new a;n.id=t.id,n.name=t.name,n.email=t.email,n.photoUrl="https://graph.facebook.com/"+t.id+"/picture?type=normal",n.firstName=t.first_name,n.lastName=t.last_name,n.authToken=o.accessToken,n.response=t,e(n)}))}else n("User cancelled login or did not fully authorize.")}),t)}))},t.prototype.signOut=function(){return new Promise((function(e,t){FB.logout((function(t){e()}))}))},t}(s);f.PROVIDER_ID="FACEBOOK";var d=function(e){function t(t,n){void 0===n&&(n={scope:"profile",scope_data:{profile:{essential:!1}},redirect_uri:location.origin});var i=e.call(this)||this;return i.clientId=t,i.initOptions=n,i}return c(t,e),t.prototype.initialize=function(){var e=this,t=null;return document&&((t=document.createElement("div")).id="amazon-root",document.body.appendChild(t)),window.onAmazonLoginReady=function(){amazon.Login.setClientId(e.clientId)},new Promise((function(n,i){e.loadScript("amazon-login-sdk","https://assets.loginwithamazon.com/sdk/na/login1.js",(function(){n()}),t)}))},t.prototype.getLoginStatus=function(){var e=this;return new Promise((function(n,i){var o=e.retrieveToken();o?amazon.Login.retrieveProfile(o,(function(e){if(e.success){var t=new a;t.id=e.profile.CustomerId,t.name=e.profile.Name,t.email=e.profile.PrimaryEmail,t.response=e.profile,n(t)}else i(e.error)})):i("No user is currently logged in with "+t.PROVIDER_ID)}))},t.prototype.signIn=function(e){var t=this,n=Object.assign(Object.assign({},this.initOptions),e);return new Promise((function(e,i){amazon.Login.authorize(n,(function(n){n.error?i(n.error):amazon.Login.retrieveProfile(n.access_token,(function(i){var o=new a;o.id=i.profile.CustomerId,o.name=i.profile.Name,o.email=i.profile.PrimaryEmail,o.authToken=n.access_token,o.response=i.profile,t.persistToken(n.access_token),e(o)}))}))}))},t.prototype.signOut=function(e){var t=this;return new Promise((function(e,n){try{amazon.Login.logout(),t.clearToken(),e()}catch(e){n(e.message)}}))},t.prototype.persistToken=function(e){localStorage.setItem(t.PROVIDER_ID+"_token",e)},t.prototype.retrieveToken=function(){return localStorage.getItem(t.PROVIDER_ID+"_token")},t.prototype.clearToken=function(){localStorage.removeItem(t.PROVIDER_ID+"_token")},t}(s);d.PROVIDER_ID="AMAZON",e.AmazonLoginProvider=d,e.BaseLoginProvider=s,e.DummyLoginProvider=l,e.FacebookLoginProvider=f,e.GoogleLoginProvider=p,e.SocialAuthService=o,e.SocialLoginModule=r,e.SocialUser=a,Object.defineProperty(e,"__esModule",{value:!0})}));
//# sourceMappingURL=angularx-social-login.umd.min.js.map